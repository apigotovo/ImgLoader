{% extends "layout/basic.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %} Загрузка {% endblock %}

    {% block header %} Загрузка {% endblock %}

    {% block content %}

            <form method="post" id ='img_form' enctype="multipart/form-data">
                {% csrf_token %}
                {{ form|crispy }}
                <input type="submit" class="btn btn-success" value="Загрузить" />
            </form>
            <div id="res">00</div>

        <script type="text/javascript">
             $("#img_form").submit(function(e){
              e.preventDefault();
              imgUpload();
             });

			function imgUpload() {

				var csrf_token = $('input[name="csrfmiddlewaretoken"]').val();
				var data = new FormData($('form')[0])
				//alert(data);
				$.ajax('http://imgloader.mergeland.me/', {
                    csrfmiddlewaretoken: csrf_token,
                    data: data, // get the form data
                    type: 'POST', // GET or POST
                    url: 'http://imgloader.mergeland.me/', // the file to call
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function(response) { // on success..
                        $('#res').html('QWERTY'); // update the DIV
                    }
                });

                return false;
			}

        </script>

    {% endblock %}
